interactions:
- request:
    body: ''
    form: {}
    headers:
      Accept:
      - application/json
    id: 0
    method: GET
    url: https://api.datadoghq.com/api/v2/security_monitoring/rules
  response:
    body: '{"data":[{"id":"def-000-vc2","version":5,"name":"''Blob public access''
      should be disabled for storage accounts with blob containers","createdAt":1681395797603,"creationAuthorId":0,"updateAuthorId":0,"isDefault":true,"isPartner":false,"isEnabled":false,"isDeleted":false,"isDeprecated":false,"queries":[{"query":"resource_type:azure_storage_account","groupByFields":["resource_type","resource_id"],"hasOptionalGroupByFields":false,"distinctFields":[],"aggregation":"count","name":"a"}],"options":{"keepAlive":21600,"maxSignalDuration":86400,"detectionMethod":"threshold","evaluationWindow":7200,"complianceRuleOptions":{"resourceType":"azure_storage_account","validationQuery":"","complianceFrameworks":[{"framework":"pci-dss","version":"4.0","requirement":"Apply-Secure-Configurations-to-All-System-Components","control":"2.2.1"},{"framework":"hipaa","version":"1","requirement":"Workforce-Security","control":"164.308-a-3-i"},{"framework":"hipaa","version":"1","requirement":"Security-Management-Process","control":"164.308-a-1-ii-B"},{"framework":"hipaa","version":"1","requirement":"Access-Control","control":"164.312-a-1"},{"framework":"gdpr","version":"1","requirement":"Data-Protection","control":"25.2"},{"framework":"gdpr","version":"1","requirement":"Security-of-Processing","control":"32.1a"},{"framework":"dcsb-m","version":"1","requirement":"Azure","control":"2.2"},{"framework":"dcsb-m","version":"1","requirement":"Azure","control":"2.8"},{"framework":"iso-27001","version":"2","requirement":"Compliance","control":"A.18.1.3"},{"framework":"iso-27001","version":"2","requirement":"Access-Control","control":"A.9.2.3"},{"framework":"soc-2","version":"2","requirement":"Logical-and-Physical-Access-Control","control":"CC6.1"},{"framework":"soc-2","version":"2","requirement":"Logical-and-Physical-Access-Control","control":"CC6.3"},{"framework":"nist-800-53","version":"5","requirement":"Configuration-Management","control":"CM-6"},{"framework":"nist-csf","version":"1.1","requirement":"Information-Protection","control":"PR.IP-1"},{"framework":"cis-azure","version":"2.0.0","requirement":"Storage-Accounts","control":"3.7"}],"filter":"","regoRule":{"policy":"package
      datadog\n\nimport data.datadog.output as dd_output\n\nimport future.keywords.contains\nimport
      future.keywords.if\nimport future.keywords.in\n\neval(storage_account) = \"pass\"
      if {\n\tstorage_account.allow_blob_public_access == false\n} else = \"fail\"\n\n#
      This part remains unchanged for all rules\nresults contains result if {\n\tsome
      resource in input.resources[input.main_resource_type]\n\tresult := dd_output.format(resource,
      eval(resource))\n}\n","resourceTypes":["azure_storage_account"]},"defaultSecurityInbox":false,"descriptionSummary":"","remediationSummary":"","resourceAttributes":[],"complexRule":false}},"complianceSignalOptions":{"defaultActivationStatus":false,"defaultGroupByFields":["@resource"],"userActivationStatus":null,"userGroupByFields":null},"cases":[{"name":"","status":"medium","notifications":[],"condition":"a
      > 0"}],"message":"## Description\n\nDisallowing public access for a storage
      account overrides the public access settings for individual containers in that
      storage account.\n\n### Default Value\n\nBy default, `Public access level` is
      set to `Private (no anonymous access)` for blob containers and `AllowBlobPublicAccess`
      is set to `Null` (allow in effect) for storage accounts.\n\n## Rationale\n\nIt
      is recommended that you avoid providing anonymous access to blob containers
      unless necessary. A Shared Access Signature (SAS) token or Azure AD RBAC should
      be used for providing controlled and timed access to blob containers. If no
      anonymous access is needed on any container in the storage account, it\u2019s
      recommended to set `allowBlobPublicAccess` to false at the account level, which
      prevents any container from accepting anonymous access in the future.\n\n###
      Impact\n\nAccess must be managed using shared access signatures or with Azure
      AD RBAC.\n\n## Remediation\n\n### From the console\n\n**Note**: You must [create
      a SAS token][1] for your blob containers before completing the following remediation
      steps.\n\n1. Go to **Storage Accounts**.\n2. For each storage account, go to
      **Configuration** in the side panel.\n3. Set **Allow Blob public access** to
      **Disabled**.\n\n### From the command line\n\nFirst, follow [Microsoft documentation][1]
      and create SAS tokens for\nyour blob containers. Then, follow the steps below:\n\n1.
      Set **Allow Blob Public Access** to `false` on the storage account.\n\n   ```\n   az
      storage account update --name <storage-account> --resource-group <resource-group>
      --allow-blob-public-access false\n   ```\n\n## References\n\n1. [https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview][1]\n2.
      [https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-prevent][2]\n3.
      [https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-governance-strategy#gs-2-define-and-implement-enterprise-segmentationseparation-of-duties-strategy][3]\n4.
      [https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-network-security#ns-2-secure-cloud-services-with-network-controls][4]\n5.
      [https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-configure][5]\n6.
      [https://docs.microsoft.com/en-us/azure/storage/blobs/assign-azure-role-data-access][6]\n\n[1]:
      https://learn.microsoft.com/en-us/azure/cognitive-services/translator/document-translation/create-sas-tokens?tabs=Containers\n[2]:
      https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-prevent\n[3]:
      https://docs.microsoft.com/en-us/security/benchmark/azure-security-controls-v3-governance-strategy#gs-2-define-and-implement-enterprise-segmentationseparation-of-duties-strategy\n[4]:
      https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-network-security#ns-2-secure-cloud-services-with-network-controls\n[5]:
      https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-configure\n[6]:
      https://docs.microsoft.com/en-us/azure/storage/blobs/assign-azure-role-data-access\n","tags":["scored:true","cloud_provider:azure","framework:gdpr","control:164.308-a-3-i","requirement:Compliance","level:1","requirement:Storage-Accounts","control:2.2.1","framework:nist-csf","requirement:Security-Management-Process","framework:dcsb-m","framework:iso-27001","framework:hipaa","requirement:Access-Control","control:164.308-a-1-ii-B","requirement:Information-Protection","scope:azure.storage","control:25.2","requirement:Workforce-Security","security:compliance","requirement:Configuration-Management","control:164.312-a-1","requirement:Azure","requirement:Apply-Secure-Configurations-to-All-System-Components","control:2.8","control:3.7","framework:cis-azure","control:2.2","framework:pci-dss","requirement:Data-Protection","framework:nist-800-53","source:azure.storage","requirement:Security-of-Processing","control:CM-6","control:A.18.1.3","framework:soc-2","control:A.9.2.3","control:PR.IP-1","control:32.1a","requirement:Logical-and-Physical-Access-Control","control:CC6.3","control:CC6.1"],"defaultTags":["framework:dcsb-m","requirement:Azure","requirement:Configuration-Management","control:2.2","control:A.9.2.3","control:CC6.3","control:CC6.1","requirement:Workforce-Security","control:2.8","framework:soc-2","requirement:Security-of-Processing","requirement:Apply-Secure-Configurations-to-All-System-Components","security:compliance","requirement:Data-Protection","framework:nist-csf","framework:pci-dss","control:164.308-a-1-ii-B","control:164.312-a-1","control:32.1a","scored:true","requirement:Storage-Accounts","requirement:Access-Control","control:A.18.1.3","level:1","framework:hipaa","requirement:Logical-and-Physical-Access-Control","scope:azure.storage","control:PR.IP-1","control:2.2.1","control:25.2","control:3.7","requirement:Information-Protection","requirement:Security-Management-Process","framework:gdpr","framework:cis-azure","requirement:Compliance","control:CM-6","source:azure.storage","cloud_provider:azure","control:164.308-a-3-i","framework:iso-27001","framework:nist-800-53"],"hasExtendedTitle":true,"type":"cloud_configuration","filters":[]},{"id":"def-000-qnx","version":2,"name":"''Create
      Policy Assignment'' activity log alert should be configured","createdAt":1695335294080,"creationAuthorId":0,"updateAuthorId":0,"isDefault":true,"isPartner":false,"isEnabled":true,"isDeleted":false,"isDeprecated":false,"queries":[{"query":"resource_type:azure_subscription","groupByFields":["resource_type","resource_id"],"hasOptionalGroupByFields":false,"distinctFields":[],"aggregation":"count","name":"a"}],"options":{"keepAlive":21600,"maxSignalDuration":86400,"detectionMethod":"threshold","evaluationWindow":7200,"complianceRuleOptions":{"resourceType":"azure_subscription","validationQuery":"","complianceFrameworks":[{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.1"},{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.2"},{"framework":"iso-27001","version":"2","requirement":"Operations-Security","control":"A.12.4.1"},{"framework":"soc-2","version":"2","requirement":"Communication-and-Information","control":"CC2.1"},{"framework":"nist-800-53","version":"5","requirement":"Audit-and-Accountability","control":"AU-6"},{"framework":"cis-azure","version":"2.0.0","requirement":"Logging-and-Monitoring","control":"5.2.1"}],"filter":"","regoRule":{"policy":"package
      datadog\n\nimport data.datadog.output as dd_output\n\nimport future.keywords.contains\nimport
      future.keywords.if\nimport future.keywords.in\n\nvalid_log_alert = {activity_log_alert.subscription_id
      |\n\tsome activity_log_alert in input.resources.azure_activity_log_alert\n\tsome
      condition in activity_log_alert.condition_all_of\n\n\tlower(condition.equals)
      == \"microsoft.authorization/policyassignments/write\"\n\tlower(condition.field)
      == \"operationname\"\n\tnot condition.contains_any\n\tlower(activity_log_alert.location)
      == \"global\"\n\n\tsome scope in activity_log_alert.scopes\n\n\tlower(split(scope,
      \"/\")[2]) == lower(activity_log_alert.subscription_id)\n\n\tactivity_log_alert.enabled\n}\n\neval(subscription)
      = \"pass\" if {\n\tvalid_log_alert[subscription.subscription_id]\n} else = \"fail\"\n\n#
      This part remains unchanged for all rules\nresults contains result if {\n\tsome
      resource in input.resources[input.main_resource_type]\n\tresult := dd_output.format(resource,
      eval(resource))\n}\n","resourceTypes":["azure_subscription","azure_activity_log_alert"]},"defaultSecurityInbox":false,"descriptionSummary":"","remediationSummary":"","resourceAttributes":[],"complexRule":true}},"complianceSignalOptions":{"defaultActivationStatus":false,"defaultGroupByFields":["@resource"],"userActivationStatus":null,"userGroupByFields":null},"cases":[{"name":"","status":"medium","notifications":[],"condition":"a
      > 0"}],"message":"\n## Description\n\nTo improve detection of unsolicited changes
      and gain insight into modifications made in \"Azure policy - assignments,\"
      it is recommended to create an activity log alert specifically for the Create
      Policy Assignment event. This alert will help monitor and track any occurrences
      of policy assignment creation, reducing the time it takes to identify and respond
      to any unauthorized changes.\n\n## Remediation\n\n### From the console\n\n1.
      Go to **Monitor** and select **Alerts**.\n2. Click **New Alert Rule**.\n3. Under
      **Scope**, click **Select Resource**.\n4. Under **Filter by Subscription**,
      select the appropriate subscription.\n5. Under **Filter by Resource Type**,
      select **Policy Assignment**.\n6. Select **All** for **Filter by Location**.\n7.
      Click the subscription resource from the entries populated under **Resource**.
      Verify that the selection preview shows **All Policy** assignment (policyAssignments)
      and the selected subscription name.\n8. Click **Done**.\n9. Under **Condition**,
      click **Add Condition**, then select the **Create Policy Assignment** signal.\n10.
      Click **Done**.\n11. Under **Action Group**, select **Add Action Groups** and
      complete the creation process or select the appropriate action group.\n12. Under
      **Alert Rule Details**, enter the **Alert Rule Name** and **Description**.\n13.
      Select the appropriate resource group to save the alert to.\n14. Select the
      **Enable alert rule upon creation** checkbox.\n15. Click **Create Alert Rule**.\n","tags":["scored:true","source:azure.activity_log","security:compliance","control:3.14.1","scope:azure.activity_log","cloud_provider:azure","control:3.14.2","framework:cis-azure","requirement:Systems-and-Information-Integrity","control:5.2.1","control:A.12.4.1","requirement:Logging-and-Monitoring","framework:nist-800-53","level:1","framework:nist-800-171","framework:soc-2","control:AU-6","framework:iso-27001","requirement:Audit-and-Accountability","control:CC2.1","requirement:Operations-Security","requirement:Communication-and-Information"],"defaultTags":["framework:nist-800-53","control:3.14.1","control:3.14.2","requirement:Systems-and-Information-Integrity","framework:soc-2","requirement:Audit-and-Accountability","framework:nist-800-171","scored:true","control:5.2.1","control:CC2.1","source:azure.activity_log","level:1","security:compliance","scope:azure.activity_log","framework:cis-azure","cloud_provider:azure","requirement:Communication-and-Information","control:A.12.4.1","control:AU-6","requirement:Operations-Security","framework:iso-27001","requirement:Logging-and-Monitoring"],"hasExtendedTitle":true,"type":"cloud_configuration","filters":[]},{"id":"def-000-9q9","version":2,"name":"''Create
      or Update Network Security Group'' activity log alert should be configured","createdAt":1695406412231,"creationAuthorId":0,"updateAuthorId":0,"isDefault":true,"isPartner":false,"isEnabled":true,"isDeleted":false,"isDeprecated":false,"queries":[{"query":"resource_type:azure_subscription","groupByFields":["resource_type","resource_id"],"hasOptionalGroupByFields":false,"distinctFields":[],"aggregation":"count","name":"a"}],"options":{"keepAlive":21600,"maxSignalDuration":86400,"detectionMethod":"threshold","evaluationWindow":7200,"complianceRuleOptions":{"resourceType":"azure_subscription","validationQuery":"","complianceFrameworks":[{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.1"},{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.2"},{"framework":"iso-27001","version":"2","requirement":"Operations-Security","control":"A.12.4.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.2"},{"framework":"soc-2","version":"2","requirement":"Communication-and-Information","control":"CC2.1"},{"framework":"nist-800-53","version":"5","requirement":"Audit-and-Accountability","control":"AU-6"},{"framework":"cis-azure","version":"2.0.0","requirement":"Logging-and-Monitoring","control":"5.2.3"}],"filter":"","regoRule":{"policy":"package
      datadog\n\nimport data.datadog.output as dd_output\n\nimport future.keywords.contains\nimport
      future.keywords.if\nimport future.keywords.in\n\nvalid_log_alert = {activity_log_alert.subscription_id
      |\n\tsome activity_log_alert in input.resources.azure_activity_log_alert\n\tsome
      condition_all_of in activity_log_alert.condition_all_of\n\tlower(condition_all_of.field)
      == \"operationname\"\n\tlower(condition_all_of.equals) == \"microsoft.network/networksecuritygroups/write\"\n\tnot
      condition_all_of.contains_any\n\n\tlower(activity_log_alert.location) == \"global\"\n\n\tsome
      scope in activity_log_alert.scopes\n\tlower(split(scope, \"/\")[2]) == lower(activity_log_alert.subscription_id)\n\n\tactivity_log_alert.enabled\n}\n\neval(subscription)
      = \"pass\" if {\n\tvalid_log_alert[subscription.subscription_id]\n} else = \"fail\"\n\n#
      This part remains unchanged for all rules\nresults contains result if {\n\tsome
      resource in input.resources[input.main_resource_type]\n\tresult := dd_output.format(resource,
      eval(resource))\n}\n","resourceTypes":["azure_subscription","azure_activity_log_alert"]},"defaultSecurityInbox":false,"descriptionSummary":"","remediationSummary":"","resourceAttributes":[],"complexRule":true}},"complianceSignalOptions":{"defaultActivationStatus":false,"defaultGroupByFields":["@resource"],"userActivationStatus":null,"userGroupByFields":null},"cases":[{"name":"","status":"medium","notifications":[],"condition":"a
      > 0"}],"message":"## Description\n\nTo improve the detection of suspicious activity
      and gain insights into network access changes, it is recommended to create an
      Activity Log Alert specifically for the \"Create or Update Network Security
      Group\" event. By monitoring these events, it becomes easier to detect and respond
      to any unauthorized modifications made to network security groups, leading to
      a quicker response time and enhanced security measures.\n\n## Remediation\n\n###
      From the console\n\n1. Navigate to the **Monitor** blade.\n2. Select **Alerts**
      > **Create** > **Alert rule**.\n3. Under **Filter by subscription**, choose
      a subscription.\n4. Under **Filter by resource type**, select **Network security
      groups**.\n5. Under **Filter by location**, select **All**.\n6. From the results,
      select the subscription, then click **Done**.\n7. Select the **Condition** tab.\n8.
      Under Signal name, click Delete **Create or Update Network Security Group (Microsoft.Network/networkSecurityGroups)**.\n9.
      Select the **Actions** tab.\n10. To use an existing action group, click **Select
      action groups**. To create a new action group, click **Create action group**.
      Fill out the appropriate details for the selection.\n11. Click the **Details**
      tab.\n12. Select a **Resource group**, then provide an **Alert rule name** and
      an optional **Alert rule description**.\n13. Click **Review + create**.\n14.
      Click **Create**.\n","tags":["scored:true","control:3.14.1","scope:azure.activity_log","cloud_provider:azure","control:3.14.2","control:A.12.4.1","level:1","framework:nist-800-171","control:5.2.3","framework:iso-27001","requirement:Audit-and-Accountability","requirement:Operations-Security","requirement:Communication-and-Information","source:azure.activity_log","security:compliance","framework:cis-azure","requirement:Systems-and-Information-Integrity","requirement:Logging-and-Monitoring","requirement:System-Operations","framework:nist-800-53","framework:soc-2","control:AU-6","control:CC2.1","control:CC7.2","control:CC7.1"],"defaultTags":["control:AU-6","framework:cis-azure","scored:true","framework:iso-27001","requirement:Logging-and-Monitoring","requirement:Systems-and-Information-Integrity","framework:nist-800-171","control:5.2.3","control:3.14.1","control:3.14.2","framework:nist-800-53","level:1","control:CC2.1","control:CC7.1","control:A.12.4.1","source:azure.activity_log","cloud_provider:azure","requirement:Audit-and-Accountability","framework:soc-2","control:CC7.2","security:compliance","requirement:Operations-Security","requirement:System-Operations","requirement:Communication-and-Information","scope:azure.activity_log"],"hasExtendedTitle":true,"type":"cloud_configuration","filters":[]},{"id":"def-000-bfa","version":2,"name":"''Create
      or Update Public Ip Address'' activity log alert should be configured","createdAt":1695406412713,"creationAuthorId":0,"updateAuthorId":0,"isDefault":true,"isPartner":false,"isEnabled":true,"isDeleted":false,"isDeprecated":false,"queries":[{"query":"resource_type:azure_subscription","groupByFields":["resource_type","resource_id"],"hasOptionalGroupByFields":false,"distinctFields":[],"aggregation":"count","name":"a"}],"options":{"keepAlive":21600,"maxSignalDuration":86400,"detectionMethod":"threshold","evaluationWindow":7200,"complianceRuleOptions":{"resourceType":"azure_subscription","validationQuery":"","complianceFrameworks":[{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.1"},{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.2"},{"framework":"iso-27001","version":"2","requirement":"Operations-Security","control":"A.12.4.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.2"},{"framework":"soc-2","version":"2","requirement":"Logical-and-Physical-Access-Control","control":"CC6.8"},{"framework":"soc-2","version":"2","requirement":"Communication-and-Information","control":"CC2.1"},{"framework":"cis-azure","version":"2.0.0","requirement":"Logging-and-Monitoring","control":"5.2.9"}],"filter":"","regoRule":{"policy":"package
      datadog\n\nimport data.datadog.output as dd_output\n\nimport future.keywords.contains\nimport
      future.keywords.if\nimport future.keywords.in\n\nvalid_log_alert = {activity_log_alert.subscription_id
      |\n\tsome activity_log_alert in input.resources.azure_activity_log_alert\n\tsome
      condition_all_of in activity_log_alert.condition_all_of\n\tlower(condition_all_of.field)
      == \"operationname\"\n\tlower(condition_all_of.equals) == \"microsoft.network/publicipaddresses/write\"\n\tnot
      condition_all_of.contains_any\n\n\tlower(activity_log_alert.location) == \"global\"\n\n\tsome
      scope in activity_log_alert.scopes\n\tlower(split(scope, \"/\")[2]) == lower(activity_log_alert.subscription_id)\n\n\tactivity_log_alert.enabled\n}\n\neval(subscription)
      = \"pass\" if {\n\tvalid_log_alert[subscription.subscription_id]\n} else = \"fail\"\n\n#
      This part remains unchanged for all rules\nresults contains result if {\n\tsome
      resource in input.resources[input.main_resource_type]\n\tresult := dd_output.format(resource,
      eval(resource))\n}\n","resourceTypes":["azure_subscription","azure_activity_log_alert"]},"defaultSecurityInbox":false,"descriptionSummary":"","remediationSummary":"","resourceAttributes":[],"complexRule":true}},"complianceSignalOptions":{"defaultActivationStatus":false,"defaultGroupByFields":["@resource"],"userActivationStatus":null,"userGroupByFields":null},"cases":[{"name":"","status":"medium","notifications":[],"condition":"a
      > 0"}],"message":"## Description\n\nTo enhance network security monitoring and
      expedite the detection of suspicious activity, it is recommended to create an
      activity log alert specifically for the \"Create or Update Public IP Addresses
      Rule\" event. By enabling this alert, you gain valuable insights into changes
      made to public IP addresses rules. It is important to note that enabling this
      alert may lead to a substantial increase in log size, especially if there are
      a significant number of administrative actions performed on a server. However,
      the benefits of improved security monitoring outweigh the potential impact on
      log size.\n\n## Remediation\n\n### From the console\n\n1. Navigate to the **Monitor**
      blade.\n2. Select **Alerts** > **Create** > **Alert rule**.\n3. Under **Filter
      by subscription**, choose a subscription.\n4. Under **Filter by resource type**,
      select **Public IP addresses**.\n5. Under **Filter by location**, select **All**.\n6.
      From the results, select the subscription, then click **Done**.\n7. Click the
      **Condition** tab.\n8. Under Signal name, click Delete **Create/Update Public
      Ip Address (Microsoft.Network/publicIPAddresses)**.\n9. Click the **Actions**
      tab.\n10. To use an existing action group, click **Select action groups**. To
      create a new action group, click **Create action group**. Fill out the appropriate
      details for the selection.\n11. Click the **Details** tab.\n12. Select a **Resource
      group**, then provide an **Alert rule name** and an optional **Alert rule description**.\n13.
      Click **Review + create**.\n14. Click **Create**.\n","tags":["control:CC6.8","scored:true","source:azure.activity_log","security:compliance","control:3.14.1","scope:azure.activity_log","cloud_provider:azure","control:3.14.2","framework:cis-azure","requirement:Systems-and-Information-Integrity","control:A.12.4.1","requirement:Logging-and-Monitoring","requirement:System-Operations","control:5.2.9","level:1","framework:nist-800-171","framework:soc-2","framework:iso-27001","requirement:Logical-and-Physical-Access-Control","control:CC2.1","control:CC7.2","control:CC7.1","requirement:Operations-Security","requirement:Communication-and-Information"],"defaultTags":["security:compliance","requirement:Systems-and-Information-Integrity","control:CC2.1","requirement:Logical-and-Physical-Access-Control","control:CC7.1","control:CC7.2","cloud_provider:azure","control:CC6.8","requirement:Logging-and-Monitoring","control:5.2.9","scope:azure.activity_log","control:3.14.1","control:3.14.2","framework:soc-2","source:azure.activity_log","control:A.12.4.1","scored:true","framework:iso-27001","requirement:Communication-and-Information","requirement:Operations-Security","level:1","framework:nist-800-171","framework:cis-azure","requirement:System-Operations"],"hasExtendedTitle":true,"type":"cloud_configuration","filters":[]},{"id":"def-000-w0f","version":2,"name":"''Create
      or Update SQL Server Firewall Rule'' activity log alert should be configured","createdAt":1695406413348,"creationAuthorId":0,"updateAuthorId":0,"isDefault":true,"isPartner":false,"isEnabled":true,"isDeleted":false,"isDeprecated":false,"queries":[{"query":"resource_type:azure_subscription","groupByFields":["resource_type","resource_id"],"hasOptionalGroupByFields":false,"distinctFields":[],"aggregation":"count","name":"a"}],"options":{"keepAlive":21600,"maxSignalDuration":86400,"detectionMethod":"threshold","evaluationWindow":7200,"complianceRuleOptions":{"resourceType":"azure_subscription","validationQuery":"","complianceFrameworks":[{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.1"},{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.2"},{"framework":"iso-27001","version":"2","requirement":"Operations-Security","control":"A.12.4.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.2"},{"framework":"soc-2","version":"2","requirement":"Logical-and-Physical-Access-Control","control":"CC6.8"},{"framework":"soc-2","version":"2","requirement":"Communication-and-Information","control":"CC2.1"},{"framework":"cis-azure","version":"2.0.0","requirement":"Logging-and-Monitoring","control":"5.2.7"}],"filter":"","regoRule":{"policy":"package
      datadog\n\nimport data.datadog.output as dd_output\n\nimport future.keywords.contains\nimport
      future.keywords.if\nimport future.keywords.in\n\nvalid_log_alert = {activity_log_alert.subscription_id
      |\n\tsome activity_log_alert in input.resources.azure_activity_log_alert\n\tsome
      condition_all_of in activity_log_alert.condition_all_of\n\tlower(condition_all_of.field)
      == \"operationname\"\n\tlower(condition_all_of.equals) == \"microsoft.sql/servers/firewallrules/write\"\n\tnot
      condition_all_of.contains_any\n\n\tlower(activity_log_alert.location) == \"global\"\n\n\tsome
      scope in activity_log_alert.scopes\n\tlower(split(scope, \"/\")[2]) == lower(activity_log_alert.subscription_id)\n\n\tactivity_log_alert.enabled\n}\n\neval(subscription)
      = \"pass\" if {\n\tvalid_log_alert[subscription.subscription_id]\n} else = \"fail\"\n\n#
      This part remains unchanged for all rules\nresults contains result if {\n\tsome
      resource in input.resources[input.main_resource_type]\n\tresult := dd_output.format(resource,
      eval(resource))\n}\n","resourceTypes":["azure_subscription","azure_activity_log_alert"]},"defaultSecurityInbox":false,"descriptionSummary":"","remediationSummary":"","resourceAttributes":[],"complexRule":true}},"complianceSignalOptions":{"defaultActivationStatus":false,"defaultGroupByFields":["@resource"],"userActivationStatus":null,"userGroupByFields":null},"cases":[{"name":"","status":"medium","notifications":[],"condition":"a
      > 0"}],"message":"## Description\n\nTo enhance the monitoring of network access
      changes and reduce the time it takes to identify suspicious activity, it is
      recommended to create an activity log alert specifically for the \"Create or
      Update SQL Server Firewall Rule\" event. By enabling this alert, you gain valuable
      insights into modifications made to SQL Server firewall rules. It is important
      to note that enabling this alert may lead to a substantial increase in log size
      if there are numerous administrative actions on a server. However, the benefits
      of improved security monitoring outweigh the potential impact on log size.\n\n##
      Remediation\n\n### From the console\n\n1. Navigate to the **Monitor** blade.\n2.
      Select **Alerts** > **Create** > **Alert rule**.\n3. Under **Filter by subscription**,
      choose a subscription.\n4. Under **Filter by resource type**, select **Server
      Firewall Rule (servers/firewallRules)**.\n5. Under **Filter by location**, select
      **All**.\n6. From the results, select the subscription, then click **Done**.\n7.
      Click the **Condition** tab.\n8. Under Signal name, click Delete **Create/Update
      server firewall rule (Microsoft.Sql/servers/firewallRules)**.\n9. Click the
      **Actions** tab.\n10. To use an existing action group, click **Select action
      groups**. To create a new action group, click **Create action group**. Fill
      out the appropriate details for the selection.\n11. Click the **Details** tab.\n12.
      Select a **Resource group**, provide an **Alert rule name** and an optional
      **Alert\nrule description**.\n13. Click **Review + create**.\n14. Click **Create**.\n","tags":["control:CC6.8","scored:true","source:azure.activity_log","security:compliance","control:3.14.1","scope:azure.activity_log","cloud_provider:azure","control:3.14.2","framework:cis-azure","requirement:Systems-and-Information-Integrity","control:A.12.4.1","requirement:Logging-and-Monitoring","requirement:System-Operations","control:5.2.7","level:1","framework:nist-800-171","framework:soc-2","framework:iso-27001","requirement:Logical-and-Physical-Access-Control","control:CC2.1","control:CC7.2","control:CC7.1","requirement:Operations-Security","requirement:Communication-and-Information"],"defaultTags":["security:compliance","requirement:Systems-and-Information-Integrity","control:CC2.1","requirement:Logical-and-Physical-Access-Control","control:CC7.1","control:CC7.2","cloud_provider:azure","control:CC6.8","requirement:Logging-and-Monitoring","control:5.2.7","scope:azure.activity_log","control:3.14.1","control:3.14.2","framework:soc-2","source:azure.activity_log","control:A.12.4.1","scored:true","framework:iso-27001","requirement:Communication-and-Information","requirement:Operations-Security","level:1","framework:nist-800-171","framework:cis-azure","requirement:System-Operations"],"hasExtendedTitle":true,"type":"cloud_configuration","filters":[]},{"id":"def-000-059","version":2,"name":"''Create
      or Update Security Solutions'' activity log alert should be configured","createdAt":1695406412988,"creationAuthorId":0,"updateAuthorId":0,"isDefault":true,"isPartner":false,"isEnabled":true,"isDeleted":false,"isDeprecated":false,"queries":[{"query":"resource_type:azure_subscription","groupByFields":["resource_type","resource_id"],"hasOptionalGroupByFields":false,"distinctFields":[],"aggregation":"count","name":"a"}],"options":{"keepAlive":21600,"maxSignalDuration":86400,"detectionMethod":"threshold","evaluationWindow":7200,"complianceRuleOptions":{"resourceType":"azure_subscription","validationQuery":"","complianceFrameworks":[{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.1"},{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.2"},{"framework":"iso-27001","version":"2","requirement":"Operations-Security","control":"A.12.4.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.2"},{"framework":"soc-2","version":"2","requirement":"Logical-and-Physical-Access-Control","control":"CC6.8"},{"framework":"soc-2","version":"2","requirement":"Communication-and-Information","control":"CC2.1"},{"framework":"cis-azure","version":"2.0.0","requirement":"Logging-and-Monitoring","control":"5.2.5"}],"filter":"","regoRule":{"policy":"package
      datadog\n\nimport data.datadog.output as dd_output\n\nimport future.keywords.contains\nimport
      future.keywords.if\nimport future.keywords.in\n\nvalid_log_alert = {activity_log_alert.subscription_id
      |\n\tsome activity_log_alert in input.resources.azure_activity_log_alert\n\tsome
      condition_all_of in activity_log_alert.condition_all_of\n\tlower(condition_all_of.field)
      == \"operationname\"\n\tlower(condition_all_of.equals) == \"microsoft.security/securitysolutions/write\"\n\tnot
      condition_all_of.contains_any\n\n\tlower(activity_log_alert.location) == \"global\"\n\n\tsome
      scope in activity_log_alert.scopes\n\tlower(split(scope, \"/\")[2]) == lower(activity_log_alert.subscription_id)\n\n\tactivity_log_alert.enabled\n}\n\neval(subscription)
      = \"pass\" if {\n\tvalid_log_alert[subscription.subscription_id]\n} else = \"fail\"\n\n#
      This part remains unchanged for all rules\nresults contains result if {\n\tsome
      resource in input.resources[input.main_resource_type]\n\tresult := dd_output.format(resource,
      eval(resource))\n}\n","resourceTypes":["azure_subscription","azure_activity_log_alert"]},"defaultSecurityInbox":false,"descriptionSummary":"","remediationSummary":"","resourceAttributes":[],"complexRule":true}},"complianceSignalOptions":{"defaultActivationStatus":false,"defaultGroupByFields":["@resource"],"userActivationStatus":null,"userGroupByFields":null},"cases":[{"name":"","status":"medium","notifications":[],"condition":"a
      > 0"}],"message":"## Description\n\nTo improve the detection of suspicious activity
      and gain insights into changes made to security solutions, it is recommended
      to create an activity log alert specifically for the \"Create or Update Security
      Solution\" event. By monitoring these events, you can quickly detect any modifications
      to active security solutions, reducing the time it takes to identify and respond
      to potential security threats.\n\n## Remediation\n\n### From the console\n\n1.
      Navigate to the **Monitor** blade.\n2. Select **Alerts** > **Create** > **Alert
      rule**.\n3. Under **Filter by subscription**, choose a subscription.\n4. Under
      **Filter by resource type**, select **Security Solutions (securitySolutions)**.\n5.
      Under **Filter by location**, select **All**.\n6. From the results, select the
      subscription, then click **Done**.\n7. Click the **Condition** tab.\n8. Under
      Signal name, click Delete **Create or Update Security Solutions (Microsoft.Security/securitySolutions)**.\n9.
      Click the **Actions** tab.\n10. To use an existing action group, click **Select
      action groups**. To create a new action group, click **Create action group**.
      Fill out the appropriate details for the selection.\n11. Click the **Details**
      tab.\n12. Select a **Resource group**, then provide an **Alert rule name** and
      an optional **Alert\nrule description**.\n13. Click **Review + create**.\n14.
      Click **Create**.\n","tags":["control:CC6.8","scored:true","source:azure.activity_log","security:compliance","control:3.14.1","scope:azure.activity_log","cloud_provider:azure","control:3.14.2","framework:cis-azure","requirement:Systems-and-Information-Integrity","control:A.12.4.1","requirement:Logging-and-Monitoring","requirement:System-Operations","level:1","framework:nist-800-171","framework:soc-2","control:5.2.5","framework:iso-27001","requirement:Logical-and-Physical-Access-Control","control:CC2.1","control:CC7.2","control:CC7.1","requirement:Operations-Security","requirement:Communication-and-Information"],"defaultTags":["security:compliance","requirement:Systems-and-Information-Integrity","control:CC2.1","requirement:Logical-and-Physical-Access-Control","control:CC7.1","control:CC7.2","cloud_provider:azure","control:CC6.8","requirement:Logging-and-Monitoring","control:5.2.5","scope:azure.activity_log","control:3.14.1","control:3.14.2","framework:soc-2","source:azure.activity_log","control:A.12.4.1","scored:true","framework:iso-27001","requirement:Communication-and-Information","requirement:Operations-Security","level:1","framework:nist-800-171","framework:cis-azure","requirement:System-Operations"],"hasExtendedTitle":true,"type":"cloud_configuration","filters":[]},{"id":"def-000-rhj","version":2,"name":"''Delete
      Network Security Group'' activity log alert should be configured","createdAt":1695406412766,"creationAuthorId":0,"updateAuthorId":0,"isDefault":true,"isPartner":false,"isEnabled":true,"isDeleted":false,"isDeprecated":false,"queries":[{"query":"resource_type:azure_subscription","groupByFields":["resource_type","resource_id"],"hasOptionalGroupByFields":false,"distinctFields":[],"aggregation":"count","name":"a"}],"options":{"keepAlive":21600,"maxSignalDuration":86400,"detectionMethod":"threshold","evaluationWindow":7200,"complianceRuleOptions":{"resourceType":"azure_subscription","validationQuery":"","complianceFrameworks":[{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.1"},{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.2"},{"framework":"iso-27001","version":"2","requirement":"Operations-Security","control":"A.12.4.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.2"},{"framework":"soc-2","version":"2","requirement":"Communication-and-Information","control":"CC2.1"},{"framework":"cis-azure","version":"2.0.0","requirement":"Logging-and-Monitoring","control":"5.2.4"}],"filter":"","regoRule":{"policy":"package
      datadog\n\nimport data.datadog.output as dd_output\n\nimport future.keywords.contains\nimport
      future.keywords.if\nimport future.keywords.in\n\nvalid_log_alert = {activity_log_alert.subscription_id
      |\n\tsome activity_log_alert in input.resources.azure_activity_log_alert\n\tsome
      condition_all_of in activity_log_alert.condition_all_of\n\tlower(condition_all_of.field)
      == \"operationname\"\n\tlower(condition_all_of.equals) == \"microsoft.network/networksecuritygroups/delete\"\n\tnot
      condition_all_of.contains_any\n\n\tlower(activity_log_alert.location) == \"global\"\n\n\tsome
      scope in activity_log_alert.scopes\n\tlower(split(scope, \"/\")[2]) == lower(activity_log_alert.subscription_id)\n\n\tactivity_log_alert.enabled\n}\n\neval(subscription)
      = \"pass\" if {\n\tvalid_log_alert[subscription.subscription_id]\n} else = \"fail\"\n\n#
      This part remains unchanged for all rules\nresults contains result if {\n\tsome
      resource in input.resources[input.main_resource_type]\n\tresult := dd_output.format(resource,
      eval(resource))\n}\n","resourceTypes":["azure_subscription","azure_activity_log_alert"]},"defaultSecurityInbox":false,"descriptionSummary":"","remediationSummary":"","resourceAttributes":[],"complexRule":true}},"complianceSignalOptions":{"defaultActivationStatus":false,"defaultGroupByFields":["@resource"],"userActivationStatus":null,"userGroupByFields":null},"cases":[{"name":"","status":"medium","notifications":[],"condition":"a
      > 0"}],"message":"## Description\n\nTo enhance the detection of suspicious activity
      and gain insights into network access changes, it is recommended to create an
      activity log alert specifically for the \"Delete Network Security Group\" event.
      Monitoring these events allows for quick detection and response to any unauthorized
      deletion of network security groups, reducing the time it takes to identify
      and address potential security threats.\n\n## Remediation\n\n### From the console\n\n1.
      Navigate to the **Monitor** blade.\n2. Select **Alerts** > **Create** > **Alert
      rule**.\n3. Under **Filter by subscription**, choose a subscription.\n4. Under
      **Filter by resource type**, select **Network security groups**.\n5. Under **Filter
      by location**, select **All**.\n6. From the results, select the subscription,
      then click **Done**.\n7. Click the **Condition** tab.\n8. Under Signal name,
      click Delete **Network Security Group (Microsoft.Network/networkSecurityGroups)**.\n9.
      Click the **Actions** tab.\n10. To use an existing action group, click **Select
      action groups**. To create a new action group, click **Create action group**.
      Fill out the appropriate details for the selection.\n11. Click the **Details**
      tab.\n12. Select a **Resource group**, then provide an **Alert rule name** and
      an optional **Alert rule description**.\n13. Click **Review + create**.\n14.
      Click **Create**.\n","tags":["scored:true","source:azure.activity_log","security:compliance","control:3.14.1","scope:azure.activity_log","cloud_provider:azure","control:3.14.2","framework:cis-azure","requirement:Systems-and-Information-Integrity","control:A.12.4.1","requirement:Logging-and-Monitoring","requirement:System-Operations","level:1","framework:nist-800-171","framework:soc-2","control:5.2.4","framework:iso-27001","control:CC2.1","control:CC7.2","control:CC7.1","requirement:Operations-Security","requirement:Communication-and-Information"],"defaultTags":["control:3.14.1","control:3.14.2","requirement:Systems-and-Information-Integrity","framework:soc-2","requirement:System-Operations","framework:nist-800-171","scored:true","control:CC2.1","source:azure.activity_log","level:1","control:5.2.4","security:compliance","scope:azure.activity_log","control:CC7.2","framework:cis-azure","cloud_provider:azure","control:CC7.1","requirement:Communication-and-Information","control:A.12.4.1","requirement:Operations-Security","framework:iso-27001","requirement:Logging-and-Monitoring"],"hasExtendedTitle":true,"type":"cloud_configuration","filters":[]},{"id":"def-000-d1v","version":2,"name":"''Delete
      Policy Assignment'' activity log alert should be configured","createdAt":1695406412546,"creationAuthorId":0,"updateAuthorId":0,"isDefault":true,"isPartner":false,"isEnabled":true,"isDeleted":false,"isDeprecated":false,"queries":[{"query":"resource_type:azure_subscription","groupByFields":["resource_type","resource_id"],"hasOptionalGroupByFields":false,"distinctFields":[],"aggregation":"count","name":"a"}],"options":{"keepAlive":21600,"maxSignalDuration":86400,"detectionMethod":"threshold","evaluationWindow":7200,"complianceRuleOptions":{"resourceType":"azure_subscription","validationQuery":"","complianceFrameworks":[{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.1"},{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.2"},{"framework":"iso-27001","version":"2","requirement":"Compliance","control":"A.18.1.3"},{"framework":"iso-27001","version":"2","requirement":"Communications-Security","control":"A.13.1.1"},{"framework":"iso-27001","version":"2","requirement":"Operations-Security","control":"A.12.4.1"},{"framework":"iso-27001","version":"2","requirement":"Access-Control","control":"A.9.1.2"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.2"},{"framework":"soc-2","version":"2","requirement":"Communication-and-Information","control":"CC2.1"},{"framework":"nist-800-53","version":"5","requirement":"Audit-and-Accountability","control":"AU-6"},{"framework":"cis-azure","version":"2.0.0","requirement":"Logging-and-Monitoring","control":"5.2.2"}],"filter":"","regoRule":{"policy":"package
      datadog\n\nimport data.datadog.output as dd_output\n\nimport future.keywords.contains\nimport
      future.keywords.if\nimport future.keywords.in\n\nvalid_log_alert = {activity_log_alert.subscription_id
      |\n\tsome activity_log_alert in input.resources.azure_activity_log_alert\n\tsome
      condition_all_of in activity_log_alert.condition_all_of\n\tlower(condition_all_of.field)
      == \"operationname\"\n\tlower(condition_all_of.equals) == \"microsoft.authorization/policyassignments/delete\"\n\tnot
      condition_all_of.contains_any\n\n\tlower(activity_log_alert.location) == \"global\"\n\n\tsome
      scope in activity_log_alert.scopes\n\tlower(split(scope, \"/\")[2]) == lower(activity_log_alert.subscription_id)\n\n\tactivity_log_alert.enabled\n}\n\neval(subscription)
      = \"pass\" if {\n\tvalid_log_alert[subscription.subscription_id]\n} else = \"fail\"\n\n#
      This part remains unchanged for all rules\nresults contains result if {\n\tsome
      resource in input.resources[input.main_resource_type]\n\tresult := dd_output.format(resource,
      eval(resource))\n}\n","resourceTypes":["azure_subscription","azure_activity_log_alert"]},"defaultSecurityInbox":false,"descriptionSummary":"","remediationSummary":"","resourceAttributes":[],"complexRule":true}},"complianceSignalOptions":{"defaultActivationStatus":false,"defaultGroupByFields":["@resource"],"userActivationStatus":null,"userGroupByFields":null},"cases":[{"name":"","status":"medium","notifications":[],"condition":"a
      > 0"}],"message":"## Description\n\nTo enhance the detection of unsolicited
      changes and streamline the monitoring of modifications made in the **Policy
      - Assignments** page, it is advised to create an activity log alert specifically
      for the \"Delete Policy Assignment\" event. This alert will provide valuable
      insights into any deletions of policy assignments, allowing for quick detection
      and response to unauthorized changes.\n\n## Remediation\n\n### From the console\n\n1.
      Navigate to the **Monitor** blade.\n2. Select **Alerts** > **Create** > **Alert
      rule**.\n3. Under **Filter by subscription**, choose a subscription.\n4. Under
      **Filter by resource type**, select **Policy Assignment**.\n5. Under **Filter
      by location**, select **All**.\n6. From the results, select the subscription,
      then click **Done**.\n7. Select the **Condition** tab.\n8. Under Signal name,
      click Delete **Delete policy assignment (Microsoft.Authorization/policyAssignments)**.\n9.
      Select the **Actions** tab.\n10. To use an existing action group, click **Select
      action groups**. To create a new action group, click **Create action group**.
      Fill out the appropriate details for the selection.\n11. Select the **Details**
      tab.\n12. Select a **Resource group**, provide an **Alert rule name** and an
      optional **Alert\nrule description**.\n13. Click **Review + create**.\n14. Click
      **Create**.\n","tags":["scored:true","control:3.14.1","scope:azure.activity_log","cloud_provider:azure","control:3.14.2","control:A.12.4.1","requirement:Compliance","level:1","control:5.2.2","framework:nist-800-171","framework:iso-27001","requirement:Audit-and-Accountability","requirement:Access-Control","requirement:Operations-Security","requirement:Communication-and-Information","source:azure.activity_log","security:compliance","framework:cis-azure","requirement:Systems-and-Information-Integrity","requirement:Communications-Security","requirement:Logging-and-Monitoring","requirement:System-Operations","framework:nist-800-53","control:A.13.1.1","control:A.18.1.3","framework:soc-2","control:AU-6","control:A.9.1.2","control:CC2.1","control:CC7.2","control:CC7.1"],"defaultTags":["framework:iso-27001","requirement:Communication-and-Information","framework:soc-2","requirement:Access-Control","control:5.2.2","control:CC7.2","control:CC7.1","control:AU-6","source:azure.activity_log","framework:cis-azure","framework:nist-800-53","framework:nist-800-171","control:A.12.4.1","requirement:Compliance","requirement:Operations-Security","control:A.13.1.1","requirement:Systems-and-Information-Integrity","scope:azure.activity_log","control:A.9.1.2","requirement:System-Operations","control:CC2.1","requirement:Audit-and-Accountability","security:compliance","control:3.14.1","control:3.14.2","requirement:Communications-Security","cloud_provider:azure","level:1","requirement:Logging-and-Monitoring","control:A.18.1.3","scored:true"],"hasExtendedTitle":true,"type":"cloud_configuration","filters":[]},{"id":"def-000-2sc","version":2,"name":"''Delete
      Public Ip Address Rule'' activity log alert should be configured","createdAt":1695406411919,"creationAuthorId":0,"updateAuthorId":0,"isDefault":true,"isPartner":false,"isEnabled":true,"isDeleted":false,"isDeprecated":false,"queries":[{"query":"resource_type:azure_subscription","groupByFields":["resource_type","resource_id"],"hasOptionalGroupByFields":false,"distinctFields":[],"aggregation":"count","name":"a"}],"options":{"keepAlive":21600,"maxSignalDuration":86400,"detectionMethod":"threshold","evaluationWindow":7200,"complianceRuleOptions":{"resourceType":"azure_subscription","validationQuery":"","complianceFrameworks":[{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.1"},{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.2"},{"framework":"iso-27001","version":"2","requirement":"Operations-Security","control":"A.12.4.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.2"},{"framework":"soc-2","version":"2","requirement":"Logical-and-Physical-Access-Control","control":"CC6.8"},{"framework":"soc-2","version":"2","requirement":"Communication-and-Information","control":"CC2.1"},{"framework":"cis-azure","version":"2.0.0","requirement":"Logging-and-Monitoring","control":"5.2.10"}],"filter":"","regoRule":{"policy":"package
      datadog\n\nimport data.datadog.output as dd_output\n\nimport future.keywords.contains\nimport
      future.keywords.if\nimport future.keywords.in\n\nvalid_log_alert = {activity_log_alert.subscription_id
      |\n\tsome activity_log_alert in input.resources.azure_activity_log_alert\n\tsome
      condition_all_of in activity_log_alert.condition_all_of\n\tlower(condition_all_of.field)
      == \"operationname\"\n\tlower(condition_all_of.equals) == \"microsoft.network/publicipaddresses/delete\"\n\tnot
      condition_all_of.contains_any\n\n\tlower(activity_log_alert.location) == \"global\"\n\n\tsome
      scope in activity_log_alert.scopes\n\tlower(split(scope, \"/\")[2]) == lower(activity_log_alert.subscription_id)\n\n\tactivity_log_alert.enabled\n}\n\neval(subscription)
      = \"pass\" if {\n\tvalid_log_alert[subscription.subscription_id]\n} else = \"fail\"\n\n#
      This part remains unchanged for all rules\nresults contains result if {\n\tsome
      resource in input.resources[input.main_resource_type]\n\tresult := dd_output.format(resource,
      eval(resource))\n}\n","resourceTypes":["azure_subscription","azure_activity_log_alert"]},"defaultSecurityInbox":false,"descriptionSummary":"","remediationSummary":"","resourceAttributes":[],"complexRule":true}},"complianceSignalOptions":{"defaultActivationStatus":false,"defaultGroupByFields":["@resource"],"userActivationStatus":null,"userGroupByFields":null},"cases":[{"name":"","status":"medium","notifications":[],"condition":"a
      > 0"}],"message":"## Description\n\nTo enhance network security monitoring and
      expedite the detection of suspicious activity, it is recommended to create an
      activity log alert specifically for the \"Delete Public IP Addresses Rule\"
      event. By enabling this alert, you gain valuable insights into the deletions
      of public IP addresses rules. It is important to note that enabling this alert
      may result in a substantial increase in log size, particularly if there are
      numerous administrative actions performed on a server. However, the benefits
      of improved security monitoring outweigh the potential impact on log size.\n\n##
      Remediation\n\n### From the console\n\n1. Navigate to the **Monitor** blade.\n2.
      Select **Alerts** > **Create** > **Alert rule**.\n3. Under **Filter by subscription**,
      choose a subscription.\n4. Under **Filter by resource type**, select **Public
      IP addresses**.\n5. Under **Filter by location**, select **All**.\n6. From the
      results, select the subscription, then click **Done**.\n7. Select the **Condition**
      tab.\n8. Under Signal name, click Delete **Delete Public Ip Address (Microsoft.Network/publicIPAddresses)**.\n9.
      Select the **Actions** tab.\n10. To use an existing action group, click **Select
      action groups**. To create a new action group, click **Create action group**.
      Fill out the appropriate details for the selection.\n11. Select the **Details**
      tab.\n12. Select a **Resource group**, provide an **Alert rule name** and an
      optional **Alert\nrule description**.\n13. Click **Review + create**.\n14. Click
      **Create**.\n","tags":["control:CC6.8","scored:true","source:azure.activity_log","security:compliance","control:3.14.1","scope:azure.activity_log","cloud_provider:azure","control:3.14.2","framework:cis-azure","requirement:Systems-and-Information-Integrity","control:A.12.4.1","requirement:Logging-and-Monitoring","requirement:System-Operations","level:1","framework:nist-800-171","control:5.2.10","framework:soc-2","framework:iso-27001","requirement:Logical-and-Physical-Access-Control","control:CC2.1","control:CC7.2","control:CC7.1","requirement:Operations-Security","requirement:Communication-and-Information"],"defaultTags":["security:compliance","requirement:Systems-and-Information-Integrity","control:CC2.1","requirement:Logical-and-Physical-Access-Control","control:CC7.1","control:CC7.2","cloud_provider:azure","control:5.2.10","control:CC6.8","requirement:Logging-and-Monitoring","scope:azure.activity_log","control:3.14.1","control:3.14.2","framework:soc-2","source:azure.activity_log","control:A.12.4.1","scored:true","framework:iso-27001","requirement:Communication-and-Information","requirement:Operations-Security","level:1","framework:nist-800-171","framework:cis-azure","requirement:System-Operations"],"hasExtendedTitle":true,"type":"cloud_configuration","filters":[]},{"id":"def-000-77s","version":2,"name":"''Delete
      SQL Server Firewall Rule'' activity log alert should be configured","createdAt":1695406412914,"creationAuthorId":0,"updateAuthorId":0,"isDefault":true,"isPartner":false,"isEnabled":true,"isDeleted":false,"isDeprecated":false,"queries":[{"query":"resource_type:azure_subscription","groupByFields":["resource_type","resource_id"],"hasOptionalGroupByFields":false,"distinctFields":[],"aggregation":"count","name":"a"}],"options":{"keepAlive":21600,"maxSignalDuration":86400,"detectionMethod":"threshold","evaluationWindow":7200,"complianceRuleOptions":{"resourceType":"azure_subscription","validationQuery":"","complianceFrameworks":[{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.1"},{"framework":"nist-800-171","version":"2","requirement":"Systems-and-Information-Integrity","control":"3.14.2"},{"framework":"iso-27001","version":"2","requirement":"Operations-Security","control":"A.12.4.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.1"},{"framework":"soc-2","version":"2","requirement":"System-Operations","control":"CC7.2"},{"framework":"soc-2","version":"2","requirement":"Logical-and-Physical-Access-Control","control":"CC6.8"},{"framework":"soc-2","version":"2","requirement":"Communication-and-Information","control":"CC2.1"},{"framework":"cis-azure","version":"2.0.0","requirement":"Logging-and-Monitoring","control":"5.2.8"}],"filter":"","regoRule":{"policy":"package
      datadog\n\nimport data.datadog.output as dd_output\n\nimport future.keywords.contains\nimport
      future.keywords.if\nimport future.keywords.in\n\nvalid_log_alert = {activity_log_alert.subscription_id
      |\n\tsome activity_log_alert in input.resources.azure_activity_log_alert\n\tsome
      condition_all_of in activity_log_alert.condition_all_of\n\tlower(condition_all_of.field)
      == \"operationname\"\n\tlower(condition_all_of.equals) == \"microsoft.sql/servers/firewallrules/delete\"\n\tnot
      condition_all_of.contains_any\n\n\tlower(activity_log_alert.location) == \"global\"\n\n\tsome
      scope in activity_log_alert.scopes\n\tlower(split(scope, \"/\")[2]) == lower(activity_log_alert.subscription_id)\n\n\tactivity_log_alert.enabled\n}\n\neval(subscription)
      = \"pass\" if {\n\tvalid_log_alert[subscription.subscription_id]\n} else = \"fail\"\n\n#
      This part remains unchanged for all rules\nresults contains result if {\n\tsome
      resource in input.resources[input.main_resource_type]\n\tresult := dd_output.format(resource,
      eval(resource))\n}\n","resourceTypes":["azure_subscription","azure_activity_log_alert"]},"defaultSecurityInbox":false,"descriptionSummary":"","remediationSummary":"","resourceAttributes":[],"complexRule":true}},"complianceSignalOptions":{"defaultActivationStatus":false,"defaultGroupByFields":["@resource"],"userActivationStatus":null,"userGroupByFields":null},"cases":[{"name":"","status":"medium","notifications":[],"condition":"a
      > 0"}],"message":"## Description\n\nTo improve the monitoring of network access
      changes and reduce the time it takes to detect suspicious activity, it is advised
      to create an activity log alert specifically for the \"Delete SQL Server Firewall
      Rule\" event. By enabling this alert, you can gain valuable insights into deletions
      of SQL Server firewall rules. It is important to note that enabling this alert
      may result in a significant increase in log size, particularly if there are
      numerous administrative actions performed on a server. However, the enhanced
      security monitoring provided by the alert outweighs the potential impact on
      log size.\n\n## Remediation\n\n### From the console\n\n1. Navigate to the **Monitor**
      blade.\n2. Select **Alerts** > **Create** > **Alert rule**.\n3. Under **Filter
      by subscription**, choose a subscription.\n4. Under **Filter by resource type**,
      select **Server Firewall Rule (servers/firewallRules)**.\n5. Under **Filter
      by location**, select **All**.\n6. From the results, select the subscription,
      then click **Done**.\n7. Click the **Condition** tab.\n8. Under Signal name,
      click Delete **Delete server firewall rule (Microsoft.Sql/servers/firewallRules)**.\n9.
      Click the **Actions** tab.\n10. To use an existing action group, click **Select
      action groups**. To create a new action group, click **Create action group**.
      Fill out the appropriate details for the selection.\n11. Click the **Details**
      tab.\n12. Select a **Resource group**, then provide an **Alert rule name** and
      an optional **Alert rule description**.\n13. Click **Review + create**.\n14.
      Click **Create**.\n","tags":["control:CC6.8","scored:true","source:azure.activity_log","security:compliance","control:3.14.1","scope:azure.activity_log","cloud_provider:azure","control:3.14.2","framework:cis-azure","requirement:Systems-and-Information-Integrity","control:A.12.4.1","requirement:Logging-and-Monitoring","requirement:System-Operations","control:5.2.8","level:1","framework:nist-800-171","framework:soc-2","framework:iso-27001","requirement:Logical-and-Physical-Access-Control","control:CC2.1","control:CC7.2","control:CC7.1","requirement:Operations-Security","requirement:Communication-and-Information"],"defaultTags":["security:compliance","requirement:Systems-and-Information-Integrity","control:CC2.1","requirement:Logical-and-Physical-Access-Control","control:CC7.1","control:CC7.2","cloud_provider:azure","control:CC6.8","requirement:Logging-and-Monitoring","control:5.2.8","scope:azure.activity_log","control:3.14.1","control:3.14.2","framework:soc-2","source:azure.activity_log","control:A.12.4.1","scored:true","framework:iso-27001","requirement:Communication-and-Information","requirement:Operations-Security","level:1","framework:nist-800-171","framework:cis-azure","requirement:System-Operations"],"hasExtendedTitle":true,"type":"cloud_configuration","filters":[]}],"meta":{"page":{"total_count":1744,"total_filtered_count":10}}}

      '
    code: 200
    duration: 0ms
    headers:
      Content-Type:
      - application/json
    status: 200 OK
version: 2
